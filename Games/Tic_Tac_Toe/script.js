"use strict";const handlePlayer=e=>(this.sign=e,{getSign:()=>e}),handleGameBoard=(()=>{let e=["","","","","","","","",""],t=(t,r)=>{e[t]=r},r=t=>e[t],l=()=>{for(let t=0;t<e.length;t++)e[t]=""};return{setField:t,getField:r,resetFields:l,board:e}})(),displayController=(()=>{let e=document.querySelector(".game-initializer__action-btn"),t=document.querySelector("main"),r=document.querySelector(".result-conveyer"),l=document.querySelector(".result-conveyer__continue-btn"),a=document.querySelector(".result-conveyer__reset-btn"),s=document.querySelectorAll(".game-board__field"),d=document.querySelectorAll(".game-board__state"),n=document.querySelector(".main__restart-btn"),i=document.querySelectorAll(".main__score-dishandlePlayer"),o=0,c=0,g=0,u=!1;e.addEventListener("click",e=>{m(e.target),setTimeout(()=>{f(),e.target.parentElement.classList.add("disabled"),t.classList.remove("disabled")},500)});let m=e=>{function t(e){"transform"===e.propertyName&&e.target.classList.remove("clicked")}e.classList.add("clicked"),e.addEventListener("transitionend",t)};d.forEach(e=>e.addEventListener("click",e=>{let t=e.target.dataset.fieldState;gameController.getIsOver()||"set-x"==t||"set-o"==t||(gameController.playRound(parseInt(e.target.parentElement.dataset.index)),y(),m(e.target.parentElement))})),n.addEventListener("click",e=>{L(),m(e.target)}),l.addEventListener("click",e=>{m(e.target),setTimeout(()=>{e.target.parentElement.parentElement.classList.add("disabled"),u=!1,L()},500)}),a.addEventListener("click",l=>{m(l.target),o=0,c=0,g=0,u=!1,r.classList.remove("disabled"),$("reset"),setTimeout(()=>{L(),l.target.parentElement.parentElement.classList.add("disabled"),t.classList.add("disabled"),e.parentElement.classList.remove("disabled")},500)});let y=()=>{for(let e=0;e<d.length;e++)d[e].dataset.fieldState=`set-${handleGameBoard.getField(e)}`,f()},$=e=>{"x"===e?i[0].textContent=++o:"o"===e?i[2].textContent=++c:"reset"===e?i.forEach(e=>e.textContent=0):(i[1].textContent=++g,u=!0),"reset"!==e&&setTimeout(()=>{r.classList.remove("disabled"),displayResultConveyer()},1e3)},f=()=>{document.querySelectorAll("[data-field-turn]").forEach(e=>e.dataset.fieldTurn=`turn-${gameController.getCurrenthandlePlayerSign()}`),!0===u?(document.querySelectorAll("[data-field-turn]")[10].dataset.fieldTurn="",document.querySelectorAll("[data-field-turn]")[10].children[1].textContent="It's a Tie!",r.querySelector("p").classList.add("disabled"),r.querySelector("section:nth-child(2)").classList.add("greyish-text")):(document.querySelectorAll("[data-field-turn]")[10].children[1].textContent="Takes the round",r.querySelector("p").classList.remove("disabled"),r.querySelector("section:nth-child(2)").classList.remove("greyish-text"))},S=e=>{let t=[];e.forEach(e=>t.push(handleGameBoard.getField(e))),!0===t.includes("x")?(e.forEach(e=>s[e].classList.add("game-board--field-won-x")),$("x")):(e.forEach(e=>s[e].classList.add("game-board--field-won-o")),$("o"))},L=()=>{handleGameBoard.resetFields(),gameController.resetGame(),E(s),y()},E=e=>{e.forEach(e=>e.className="game-board__field")};return{setBoardBackgroundColor:S,updateScoreBoard:$}})(),gameController=(()=>{let e=handlePlayer("x"),t=handlePlayer("o"),r=1,l=!1,a=!1,s=e=>{if(handleGameBoard.setField(e,d()),n(e),a){l=!0;return}if(9===r){displayController.updateScoreBoard("tie"),l=!0;return}r++},d=()=>r%2==1?e.getSign():t.getSign(),n=e=>{let t=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]],r=e=>{e.every((e=index)=>handleGameBoard.getField(e)===d())&&(a=!0,displayController.setBoardBackgroundColor(e))};return t.filter(t=>t.includes(e)).some((e=possibilities)=>e.every(t=>{handleGameBoard.getField(t)===d()&&r(e)}))},i=()=>{l=!1,a=!1,r=1};return{playRound:s,resetGame:i,getIsOver:()=>l,getCurrenthandlePlayerSign:d}})();
