(function(a){function s(b){f(m.main);r=m.time.textContent=b;p=a.setInterval(function(){r-=1;m.time.textContent=r>9?r:"0"+r;i.tick();if(!r){q("Time's up")}},1e3);e(m.panel)}var b=a.document,c=function(a,b){a.classList.add(b)},d=function(a,b){a.classList.remove(b)},e=function(a){d(a,"h")},f=function(a){c(a,"h")},g=function(b){var c=new a.Image;c.src=b;return c},h,i,j=true,k=900,l=400,m=function(){var a=[];["main","reason","play","DOMgame","curiosity","canvasGame","canvas","landing","panel","time","message","action"].forEach(function(c){a[c]=b.getElementById(c)});return a}(),n=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.msRequestAnimationFrame,o=function(a){m.message.textContent=a||""},p,q=function(b){a.clearInterval(p);m.DOMgame.className="h";f(m.panel);f(m.canvasGame);m.reason.textContent=b;e(m.main)},r;(function(){function C(a,b){switch(a){case 38:v.yRocket=b;break;case 37:v.xRocket=b?-z:0;break;case 39:v.xRocket=b?z:0;break}}function D(a){C(a.keyCode,true)}function E(a){C(a.keyCode,false)}function F(){b.addEventListener("keydown",D);b.addEventListener("keyup",E)}function G(){b.removeEventListener("keydown",D);b.removeEventListener("keyup",E)}function H(){G();v.xRocket=v.yRocket=v.xSpeed=v.ySpeed=0;r=false;d(m.landing,"holding");x.x=v.x+x.relativeX;x.y=v.y}function I(){if(v.x>y.left&&v.x+v.width<y.right&&v.y>y.top&&v.y+v.height<y.bottom){if(!t){s=a.setTimeout(H,4e3);t=true;c(m.landing,"holding")}}else{if(t){a.clearTimeout(s);t=false;d(m.landing,"holding")}}}function J(a){t=false;r=true;G();q(a)}function K(){if(m.canvasGame.classList.contains("h")){return}i.clearRect(0,0,k,l);if(r){v.x+=v.xSpeed+=v.xRocket*A;v.y+=v.ySpeed+=v.yRocket?-A:A;if(v.y>u||v.x>k||v.x<-v.width){J("You've crashed")}I()}else{a.clearInterval(p);if(x.y+x.height<u){x.y+=.5}else{if(v.x>k){J("Mission accomplished")}v.x+=v.xSpeed+=B;v.y+=v.ySpeed-=B}i.drawImage(x.image,x.x,x.y,x.width,x.height)}if(v.xRocket||v.yRocket||!r){i.drawImage(w.image,v.x,v.y+v.height,w.width,w.height)}i.drawImage(v.image,v.x,v.y,v.width,v.height);n(K)}function L(){f(m.DOMgame);o("Use the arrows keys to land.");v.x=6*16;v.y=-v.height;v.xSpeed=1;v.ySpeed=.1;v.xRocket=v.yRocket=0;F();e(m.canvasGame);j=false;K()}var i=m.canvas.getContext("2d"),r=true,s,t=false,u=360,v={image:new g("svg/skycrane_sd.svg"),width:40,height:20},w={image:new g("svg/rockets.svg"),width:40,height:12},x={image:new g("svg/rover.svg"),width:29,height:17,relativeX:5},y={height:35,width:60,left:720,top:260,right:780,bottom:295},z=1,A=.01,B=.06;h={init:L}})();(function(){function k(){f(m.curiosity);m.play.textContent="Replay";m.DOMgame.className="";b.entry_stg.go()}function l(){if(m.DOMgame.classList.contains("h")){return}var a=g[r];if(a){j.push(a)}if(j.length>0){o(b[j[0]].msg);m.action.className=j[0]}}var b={entry_stg:{go:function(){o("Descending through the Martian atmosphere. Get ready for instructions.");c(m.DOMgame,"entry_stg")}},parachute_stg:{msg:"Deploy the supersonic parachute.",go:function(){d(m.DOMgame,"entry_stg")}},shield_stg:{msg:"Separate the heat shield.",go:function(){e(m.curiosity)}},separation_stg:{msg:"Drop out of the bottom of the aeroshell.",go:function(){o("Get ready to take manual controls.");a.setTimeout(h.init,7e3)}}},g={49:"parachute_stg",38:"shield_stg",29:"separation_stg"},j=[];m.action.addEventListener("click",function(){o();f(m.action);var a=j.shift();c(m.DOMgame,a);b[a].go()});i={init:k,tick:l}})();a.onload=function(){m.play.addEventListener("click",function(){if(j){s(70);i.init()}else{s(20);h.init()}});e(m.play)}})(this)