window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}(),function(e){var t=function(){var e=0,t=function(){return e+=1,e},n=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},r=function(e,t){var r=n(1,360);return{"hue":r,"saturation":e,"lightness":t}},i=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n].id===t.id)return e.splice(n,1),!0;return!1},s=function(e,t){return e.zIndex-t.zIndex},o=function(e){var t=parseInt(e,10),n=Math.floor(t/3600),r=Math.floor((t-n*3600)/60),i=t-n*3600-r*60;return n<10&&(n="0"+n),r<10&&(r="0"+r),i<10&&(i="0"+i),{"h":n,"m":r,"s":i}},u=function(e){return"hsl("+e.hue+", "+e.saturation+"%, "+e.lightness+"%)"};return{"getGuid":t,"getRandomInt":n,"getRandomColor":r,"removeObjFromArray":i,"sortByZIndex":s,"secondsToTime":o,"getHSLString":u}}();e.Utils=t}(window),function(e){var t=function(){this.id=e.Utils.getGuid(),this.zIndex=9999,this.width=this.originalWidth=80,this.height=this.originalHeight=80,this.sprite=new Image,this.sprite.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPAAAABQCAMAAAAQlwhOAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYxIDY0LjE0MDk0OSwgMjAxMC8xMi8wNy0xMDo1NzowMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDoyMEQ3NzYyRDk1RkNFMTExOTdCOUNCMjM5MkMwQ0Y3OCIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo1NzdFMDI4OUZDQTcxMUUxQTVEOUNFRkRCQUMwQTdCMCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo1NzdFMDI4OEZDQTcxMUUxQTVEOUNFRkRCQUMwQTdCMCIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1LjEgV2luZG93cyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkJFOUE2RTQzOUJGQ0UxMTE5N0I5Q0IyMzkyQzBDRjc4IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjIwRDc3NjJEOTVGQ0UxMTE5N0I5Q0IyMzkyQzBDRjc4Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+Kc9JJwAAAB5QTFRFOzs7is0jQkJCALT/Pj4+MzMzc68VfLobgcAfAAAAJ8LRrQAAAAp0Uk5T////////////ALLMLM8AAADOSURBVHja7NbLDsIgFEXR+mrr//+wyWVCQkrBgUG69og08ciaVJf3xVqAgYGBgYGBgYGBgYGBgYGBgScF36I9ys+p/q8ZZw8YGBj4v8Fr9IjSx/PzetDZBVv2esD1PWBgYOAZwUvRK9qi/LW/ZVWmG/bSuY3dsgcMDAw8Lzgvv85e1P9n/1d7wMDAwFcCl539FNUvOMIeMDAw8Azg1DMqn3x7zRH2gIGBgecB36P6k55G2AMGBgaeBzxjwMDAwMDAwMDAwMDAwMDAF+gjwADrSXDr2PaazQAAAABJRU5ErkJggg==",this.frames=3,this.curFrame=0,this.frameLimiter=2,this.weight=2,this.lift=.2,this.speed=1.5,this.hunger=2,this.energy=100,this.x=0,this.y=0,this.xAccel=0,this.yAccel=.02,this.maxYUpAccel=2.5,this.flower=null,this.flowerSippingTimer=null,this.flowerTargetTimer=null,this.drainRate=2,this.lastWeightDisplayed=0};t.prototype.setPos=function(e){this.x=e.x,this.y=e.y},t.prototype.getPos=function(){return pos},t.prototype.update=function(){this.yAccel+=this.weight/100;var t=this.x+this.xAccel,n=this.y+this.yAccel;n+this.height<0&&(n=this.y,this.yAccel=0),n-this.height>e.Canvas.height&&e.Game.end(),t<0&&(t=0),t>e.Canvas.width-this.width&&(t=e.Canvas.width-this.width),this.x=t,this.y=n,this._logic()},t.prototype.draw=function(){var t=e.Canvas.context,n=Math.floor(this.curFrame/this.frameLimiter);t.drawImage(this.sprite,this.originalWidth*n,0,this.originalWidth,this.originalHeight,this.x,this.y,this.width,this.height),this.curFrame++,this.curFrame>=this.frames*this.frameLimiter&&(this.curFrame=0),this.flower!==null&&(t.save(),t.fillStyle="#e61752",t.fillRect(this.x+4,this.y+32,6,6),t.restore())},t.prototype._logic=function(){var t=e.Flower.flowers,n=null;for(var r=0,i=t.length;r<i;r++){var s={"x":this.x+10,"y":this.y+32};if(t[r].isNear(s)){n=t[r],this._targetFlower(n);break}}n===null&&this.flower!==null&&(this.flower=null,clearTimeout(this.flowerTargetTimer),clearTimeout(this.flowerSippingTimer)),this.lastWeightDisplayed+.1<this.weight&&(this.lastWeightDisplayed=this.weight,e.UI.displayWeight(this.weight))},t.prototype.flap=function(){if(this.y<0)return;this.energy-=.3,this._capAndDisplayEnergy();var e=this.yAccel-(this.lift-(100-this.energy)/600+this.y*.001);this.y-=this.lift*5;if(e<-this.maxYUpAccel)return;this.yAccel=e},t.prototype.left=function(){this.x-=this.speed},t.prototype.right=function(){this.x+=this.speed},t.prototype._targetFlower=function(e){var t=this;if(this.flower===e)return;this.flower=e,this.flowerTargetTimer=setTimeout(function(){t._sipFlower()},200)},t.prototype._sipFlower=function(){var e=this;if(this.flower===null)return;this.flower.drain(this.drainRate),this.weight+=this.drainRate/800,this.energy+=.6,this._capAndDisplayEnergy(),this.flowerSippingTimer=setTimeout(function(){e._sipFlower()},50)},t.prototype._capAndDisplayEnergy=function(){this.energy<0&&(this.energy=0),this.energy>100&&(this.energy=100),e.UI.displayEnergy(this.energy)},e.Bird=t}(window),function(e){var t=function(t){this.id=e.Utils.getGuid(),this.zIndex=this.id+15,this.width=this.height=e.Utils.getRandomInt(8,18),this.hsl={},this.hslStringFlower=null,this.hslStringPetal=null,this.rotate=e.Utils.getRandomInt(1,180),this.originatingX=0,this.stalkRGB={"r":79,"g":140,"b":17},this.stalkCurve={"x":e.Utils.getRandomInt(-50,50),"y":e.Utils.getRandomInt(50,100)},this.stalkThickness=this.width/6,this.stalkOpacity=1,this.x=0,this.y=0,this.targetY=0,this.targetX=0,this.positionBuffer=70,this.growSpeed=1,this.dieSpeed=3,this.dieXRange=10,this.dieAngle=0,this.finalY=0,this.nectar=100,this.decayRate=.05,this.growing=!1,this.dying=!1,this._init()};t.prototype.update=function(){if(this.growing)if(this.y>this.targetY){var e=this.y-this.targetY;this.y-=this.growSpeed/5+this.growSpeed*(e/50)}else this.finalY=this.targetY,this.growing=!1;else this.dying&&(this.y<this.targetY+this.height*2?(this.x=this.targetX+Math.sin(this.dieAngle)*this.dieXRange,this.y+=this.dieSpeed,this.dieAngle+=.1):(this.dying=!1,this._remove()));this.dying&&(this.rotate+=.05),this.drain(this.decayRate)},t.prototype.draw=function(){var t=e.Canvas.context;this.dying||(t.save(),t.beginPath(),t.fillStyle="#999b0f",t.arc(this.originatingX,e.Canvas.height+2,this.width/2,0,Math.PI*2,!0),t.fill(),t.restore()),t.save();var n=this.x,r=this.y;this.dying&&(this.stalkOpacity>0&&(this.stalkOpacity-=.04,this.stalkOpacity<0&&(this.stalkOpacity=0)),n=this.targetX,r=this.finalY),t.strokeStyle="rgba("+this.stalkRGB.r+", "+this.stalkRGB.g+", "+this.stalkRGB.b+", "+this.stalkOpacity+")",t.lineWidth=this.stalkThickness,t.beginPath();var i=this.dying?e.Canvas.height:e.Canvas.height-this.height/2+3;t.moveTo(this.originatingX,i),t.quadraticCurveTo(n+this.stalkCurve.x,r+this.stalkCurve.y,n,r),t.stroke(),t.restore(),t.save(),t.translate(this.x+this.width/2,this.y+this.width/2),t.rotate(this.rotate),t.translate(-(this.width/2),-(this.width/2)),t.save(),t.fillStyle=this.hslStringFlower,t.fillRect(0,0,this.width,this.height),t.restore(),t.save(),t.fillStyle=this.hslStringPetal,t.fillRect(0,-this.height+1,this.width,this.height),t.fillRect(this.width-1,0,this.width,this.height),t.fillRect(0,this.height-1,this.width,this.height),t.fillRect(-this.width+1,0,this.width,this.height),t.restore(),t.restore()},t.prototype._randomPosition=function(){var t=e.Utils.getRandomInt(this.positionBuffer/2,e.Canvas.width-this.positionBuffer),n=e.Utils.getRandomInt(this.positionBuffer,e.Canvas.height-this.positionBuffer);return this.x=this.targetX=t,this.y=e.Canvas.height,this.originatingX=e.Utils.getRandomInt(t-this.width*2,t+this.width*2),{"x":t,"y":n}},t.prototype._randomFlowerColor=function(){this.hsl=e.Utils.getRandomColor(70,50)},t.prototype._updateColor=function(){this.hslStringFlower=e.Utils.getHSLString(this.hsl),this.hslStringPetal=e.Utils.getHSLString({"hue":this.hsl.hue,"lightness":this.hsl.lightness-10,"saturation":this.hsl.saturation})},t.prototype._remove=function(){e.Game.removeFromUpdate(this),e.Game.removeFromDraw(this);if(!e.Utils.removeObjFromArray(e.Flower.flowers,this))throw new Error("Failed to remove the flower from the root.Flower.flowers array.")},t.prototype._init=function(){this._randomFlowerColor(),this._updateColor(),e.Flower.flowers.push(this),this.grow()},t.prototype.isNear=function(e){return e.x<this.x||e.y<this.y?!1:e.x>this.x+this.width||e.y>this.y+this.height?!1:!0},t.prototype.grow=function(){var e=this._randomPosition();this.targetY=e.y,this.growing=!0},t.prototype.die=function(){this.targetY=e.Canvas.height,this.dying=!0},t.prototype.drain=function(e){this.nectar-=e,this.nectar<=0&&this.die();var t=40+(100-this.nectar);t>90&&(t=90),this.hsl.lightness=t,this._updateColor()},t.flowers=[],e.Flower=t}(window),function(t){var n=function(){var r,i,s=[],o=[],u=!1,a=15,f=null,l=null,c=null,h=null,p=function(e){r=document.getElementById(e),i={"context":r.getContext("2d"),"width":r.width,"height":r.height},h=i.context.createRadialGradient(140,140,20,100,100,100),h.addColorStop(0,"rgba(240,217,19,1)"),h.addColorStop(.98,"rgba(240,196,19,.9)"),h.addColorStop(1,"rgba(240,196,19,0)"),t.Canvas=n.getCanvas()},d=function(e){if(u)return;requestAnimFrame(d),e===!0&&(u=!0),v(),m(),g()},v=function(){e.isDown(e.LEFT)&&c.left(),e.isDown(e.RIGHT)&&c.right(),e.isPreserved(e.SPACE)&&c.flap(),f===null&&(f=setTimeout(function(){clearTimeout(f),f=null;if(t.Utils.getRandomInt(1,3)!==1)return;if(t.Flower.flowers.length<a){var e=new t.Flower;b(e),E(e)}},t.Utils.getRandomInt(200,1e3)))},m=function(){for(var e=0,t=s.length;e<t;e++){var n=s[e];if(n===null||typeof n=="undefined")continue;n.update()}},g=function(){var e=i.context;e.clearRect(0,0,i.width,i.height),e.save(),e.beginPath(),e.fillStyle="rgba(225,157,12,.5)",e.arc(105,105,100,0,Math.PI*2,!0),e.fill(),e.restore(),e.save(),e.fillStyle=h,e.fillRect(0,0,300,300),e.restore();for(var t=0,n=o.length;t<n;t++){var r=o[t];if(r===null||typeof r=="undefined")continue;r.draw()}},y=function(){window.addEventListener("keyup",function(t){e.onKeyup(t)},!1),window.addEventListener("keydown",function(t){e.onKeydown(t)},!1)},b=function(e){s.push(e)},w=function(e){if(!t.Utils.removeObjFromArray(s,e))throw new Error("Failed to remove an object from the _toUpdate array.")},E=function(e){o.push(e),o.sort(t.Utils.sortByZIndex)},S=function(e){if(!t.Utils.removeObjFromArray(o,e))throw new Error("Failed to remove an object from the _toDraw array.")},x=function(){return i},T=function(e){p("stage"),y(),c=new t.Bird,b(c),E(c),c.setPos({"x":300,"y":i.height}),c.yAccel=-4,t.UI.showIntro()},N=function(e){e=e||!1,u=!1,d(e),l=(new Date).getTime()},C=function(){var e=t.Utils.secondsToTime(((new Date).getTime()-l)/1e3);u=!0,t.UI.showEnd({"time":e,"weight":c.weight})};return{"init":T,"start":N,"end":C,"removeFromDraw":S,"removeFromUpdate":w,"getCanvas":x}}();t.Game=n}(window);var e={"_pressed":{},"_preserved":{},"SPACE":32,"LEFT":37,"UP":38,"RIGHT":39,"DOWN":40,"isDown":function(e){return this._pressed[e]},"isPreserved":function(e){return typeof this._preserved[e]!="undefined"?(delete this._preserved[e],!0):!1},"onKeydown":function(e){this._pressed[e.keyCode]=!0},"onKeyup":function(t){t.keyCode===e.SPACE&&(this._preserved[t.keyCode]=!0),delete this._pressed[t.keyCode]}};(function(e){var t=function(){var t=function(e){return document.getElementById(e)},n=t("intro"),r=t("weight"),i=t("energy"),s=["Blue","Red","Pink","Yellow","Orange","Teal","Magenta","Gold","Cyan"],o=function(e){e.style.display="block"},u=function(e){e.style.display="none"},a=function(){o(n),t("begin").addEventListener("click",function(t){setTimeout(function(){u(n),o(r),o(i),e.Game.start(!1)},100)},!1)},f=function(n){u(r),u(i);var a=s[e.Utils.getRandomInt(0,s.length-1)],f=t("end-color"),l=Math.floor(n.weight*5);t("end-time").innerHTML=n.time.m+":"+n.time.s,t("end-weight").innerHTML=l+" grams",f.innerHTML=a,f.style.color=a,o(t("end")),t("again").addEventListener("click",function(e){document.location.reload(!0)},!1)},l=function(e){var t=Math.ceil(e*25);r.style.width=t+"px",console.log("new weight",e,t)},c=function(e){t("remaining").style.width=Math.floor(e*1.5)+"px"};return{"showIntro":a,"showEnd":f,"displayWeight":l,"displayEnergy":c}}();e.UI=t})(window);