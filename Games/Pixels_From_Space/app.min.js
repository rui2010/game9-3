function Game(){this.canvas=document.getElementById("screen");this.ctx=this.canvas.getContext("2d");this.stageIndex=0;this.spawnBallTimeout=50;this.spawnBallTimeoutStep=0;this.stageCompleteTimeout=75;this.stageCompleteTimeoutStep=0;this.finishTimeout=100;this.finishTimeoutStep=0;this.playerReady=false;this.stageComplete=false;this.gameComplete=false;this.gameOver=false;this.finish=false;this.enemyiesReady=false;this.locked=true;this.dialogs=new Array;this.currentDialog="";this.dialogIndex=0;this.player;this.enemys=new Array;this.particles=new Array;this.renderer;this.camera;this.ball;this.glow={max:20,min:5,value:5,fac:1};this.state;this.score=0;this.perks=new Array;this.screen={x:this.canvas.width,y:this.canvas.height};this.stages=new Array;this.stars=new Array;this.lines=new Image;this.lines.src="./assets/crt.png";this.controller;this.loadStages()}function getColor(a,b,c,d){return{r:a,g:b,b:c,a:d}}function Mob(){this.x;this.y}function Player(a,b,c){this.startY=b;this.x=a;this.y=c;this.w=25;this.h=10;this.spread=4;this.lifes=3;this.alive=true;this.base=5;this.r=Math.PI*2/1;this.life=100;this.perks=new Array;var d=new DoubleShoot;this.guns=d.guns;this.tiles=[{x:this.base*0,y:this.base*0,w:this.base*5,h:this.base*1,color:getColor(255,255,255,1)},{x:this.base*0,y:this.base*-1,w:this.base*1,h:this.base*1,color:getColor(255,255,255,1)},{x:this.base*4,y:this.base*-1,w:this.base*1,h:this.base*1,color:getColor(255,255,255,1)},{x:this.base*2,y:this.base*-3,w:this.base*1,h:this.base*2,color:getColor(255,255,255,1)},{x:this.base*2,y:this.base*1,w:this.base*1,h:this.base*1,color:getColor(255,255,255,1)},{x:this.base*2,y:this.base*-1,w:this.base*1,h:this.base*1,color:getColor(200,200,255,1)},{x:this.base*2,y:this.base*2,w:this.base*1,h:this.base*.5,color:getColor(255,0,0,1)}];this.v={x:0,y:0}}function Controller(){this.keys=new Array;this.leftDown=false;this.rightDown=false}function loadListeners(){document.onkeydown=function(a){game.controller.keyDown(game.controller.getKeyCode(a))};document.onkeyup=function(a){game.controller.keyUp(game.controller.getKeyCode(a))};document.body.onmousedown=function(a){var b=0;if(navigator.appName=="Netscape")b=a.which;else b=event.button;if(b==1)game.controller.leftDown=true;if(b==2)game.controller.rightDown=true};document.body.onmouseup=function(a){var b=0;if(navigator.appName=="Netscape")b=a.which;else b=event.button;if(b==1)game.controller.leftDown=false;if(b==2)game.controller.rightDown=false}}function Enemy(){this.startY=500}function Scout(a,b,c){this.startY=c;this.x=a;this.y=b;this.vx=5;this.vy=0;this.w=20;this.h=5;this.spread=4;this.canShoot=false;this.life=100;this.r=Math.PI*2/4;this.base=5;this.reload=Math.random()*100+10;this.guns=[new LaserGun(this.base*0,this.base*0,Math.PI*2/4,2)];this.tiles=[{x:this.base*0,y:this.base*0,w:this.base*5,h:this.base*1,color:getColor(100,100,255,1)},{x:this.base*0,y:this.base*1,w:this.base*1,h:this.base*1,color:getColor(100,100,255,1)},{x:this.base*4,y:this.base*1,w:this.base*1,h:this.base*1,color:getColor(100,100,255,1)},{x:this.base*2,y:this.base*1,w:this.base*1,h:this.base*2,color:getColor(100,100,255,1)},{x:this.base*2,y:-this.base*1,w:this.base*1,h:this.base*1,color:getColor(100,100,255,1)},{x:this.base*2,y:this.base*1,w:this.base*1,h:this.base*1,color:getColor(255,100,100,1)}]}function Destructor(a,b,c){this.startY=c;this.x=a;this.y=b;this.vx=1;this.vy=0;this.w=40;this.h=10;this.spread=4;this.canShoot=false;this.life=800;this.r=Math.PI*2/4;this.base=5;this.reload=Math.random()*20+10;this.dmg=20;this.guns=[new BomberGun(this.base*0,this.base*0,Math.PI*2/4,2)];this.tiles=[{x:0,y:0,w:this.base*6,h:this.base*2,color:getColor(100,100,255,1)},{x:0,y:this.base*2,w:this.base,h:this.base*2,color:getColor(100,100,255,1)},{x:this.base*2,y:this.base*2,w:this.base*2,h:this.base*1,color:getColor(100,100,255,1)},{x:this.base*5,y:this.base*2,w:this.base,h:this.base*2,color:getColor(100,100,255,1)},{x:this.base,y:-this.base,w:this.base,h:this.base,color:getColor(100,100,255,1)},{x:this.base*4,y:-this.base,w:this.base,h:this.base,color:getColor(100,100,255,1)},{x:this.base*2+this.base/2,y:this.base*2,w:this.base,h:this.base,color:getColor(255,100,100,1)}]}function Drone(a,b,c){this.startY=c;this.x=a;this.y=b;this.vx=8;this.vy=0;this.w=40;this.h=10;this.spread=4;this.canShoot=false;this.life=80;this.r=Math.PI*2/4;this.base=5;this.reload=Math.random()*100+10;this.dmg=5;this.guns=[new GetlingGun(this.base*0,this.base*0,Math.PI*2/4,2)];this.tiles=[{x:this.base*0,y:this.base*0,w:this.base*5,h:this.base*1,color:getColor(100,100,255,1)},{x:this.base*1,y:this.base*1,w:this.base*1,h:this.base*1,color:getColor(100,100,255,1)},{x:this.base*3,y:this.base*1,w:this.base*1,h:this.base*1,color:getColor(100,100,255,1)},{x:this.base*1,y:-this.base*1,w:this.base*3,h:this.base*1,color:getColor(100,100,255,1)},{x:this.base*2+this.base/2,y:this.base*0,w:this.base,h:this.base,color:getColor(255,100,100,1)}]}function Mothership(a,b,c){this.startY=c;this.x=a;this.y=b;this.vx=.6;this.vy=0;this.w=40;this.h=10;this.spread=4;this.canShoot=false;this.life=1e3;this.r=Math.PI*2/4;this.base=5;this.reload=Math.random()*20+10;this.dmg=20;this.guns=[new LaserGun(this.base*1,this.base*7,Math.PI*2/4,2),new LaserGun(this.base*8,this.base*7,Math.PI*2/4,2),new GetlingGun(this.base*2,this.base*4,Math.PI*2/4,2),new GetlingGun(this.base*6,this.base*4,Math.PI*2/4,2)];this.tiles=[{x:this.base*1,y:this.base*-.5,w:this.base*3,h:this.base*.5,color:getColor(255,50,50,1)},{x:this.base*5,y:this.base*-.5,w:this.base*3,h:this.base*.5,color:getColor(255,50,50,1)},{x:this.base*1,y:this.base*0,w:this.base*3,h:this.base*1,color:getColor(100,100,255,1)},{x:this.base*5,y:this.base*0,w:this.base*3,h:this.base*1,color:getColor(100,100,255,1)},{x:this.base*-1,y:this.base*1,w:this.base*11,h:this.base*2,color:getColor(100,100,255,1)},{x:this.base*0,y:this.base*3,w:this.base*1,h:this.base*4,color:getColor(100,100,255,1)},{x:this.base*8,y:this.base*3,w:this.base*1,h:this.base*4,color:getColor(100,100,255,1)},{x:this.base*2,y:this.base*3,w:this.base*5,h:this.base*1,color:getColor(100,100,255,1)},{x:this.base*2,y:this.base*4,w:this.base*1,h:this.base*2,color:getColor(100,100,255,1)},{x:this.base*6,y:this.base*4,w:this.base*1,h:this.base*2,color:getColor(100,100,255,1)},{x:this.base*4,y:this.base*4,w:this.base*1,h:this.base*1,color:getColor(100,100,255,1)},{x:this.base*4,y:this.base*4,w:this.base*1,h:this.base*1,color:getColor(255,200,200,1)}]}function GunBase(){this.x;this.y;this.w;this.h;this.r;this.reloadSpeed;this.reloadStep;this.bullets=new Array;this.canShoot=true;this.spread=2;this.damage;this.color;this.PLAYER_TYP=1;this.ENEMY_TYP=2;this.typ;this.name}function LaserGun(a,b,c,d){this.x=a;this.y=b;this.w=2;this.h=8;this.r=c;this.reloadSpeed=Math.random()*15+15;this.reloadStep=0;this.bullets=new Array;this.canShoot=true;this.spread=2;this.damage=3;this.color=getColor(255,100,100,1);this.PLAYER_TYP=1;this.ENEMY_TYP=2;this.typ=d||this.ENEMY_TYP;this.name="LaserGun"}function BomberGun(a,b,c,d){this.x=a;this.y=b;this.w=8;this.h=8;this.r=c;this.reloadSpeed=Math.random()*15+20;this.reloadStep=0;this.bullets=new Array;this.canShoot=true;this.spread=2;this.damage=25;this.color=getColor(255,100,100,1);this.PLAYER_TYP=1;this.ENEMY_TYP=2;this.typ=d||this.ENEMY_TYP;this.name="BomberGun"}function GetlingGun(a,b,c,d){this.x=a;this.y=b;this.w=4;this.h=6;this.r=c;this.reloadSpeed=Math.random()*5+15;this.reloadStep=0;this.bullets=new Array;this.canShoot=true;this.spread=2;this.damage=1;this.color=getColor(255,100,100,1);this.PLAYER_TYP=1;this.ENEMY_TYP=2;this.typ=d||this.ENEMY_TYP;this.name="GetlingGun"}function PlayerGun(a,b,c){this.x=a;this.y=b;this.w=4;this.h=6;this.r=c;this.reloadSpeed=8;this.reloadStep=0;this.bullets=new Array;this.canShoot=true;this.spread=2;this.damage=8;this.color=getColor(100,100,255,1);this.PLAYER_TYP=1;this.ENEMY_TYP=2;this.typ=this.PLAYER_TYP;this.name="PlayerGun"}function TrippleShoot(){this.guns=[new PlayerGun(base*0,base*0,Math.PI*2/4*2.8),new PlayerGun(base*2,base*0,Math.PI*2/4*3),new PlayerGun(base*4,base*0,Math.PI*2/4*3.2)]}function DoubleShoot(){this.guns=[new PlayerGun(base*0,base*0,Math.PI*2/4*3),new PlayerGun(base*4,base*0,Math.PI*2/4*3)]}function Ball(a,b){this.spawn={x:a,y:b};this.v={x:0,y:0,max:1,dir:0};this.bounds={x:10,y:10};this.direction=1;this.x=a;this.y=b;this.glow={max:20,min:5,value:5,fac:1}}function StringSplitter(a,b){var c=new Array;var d=a;while(d){if(d.length<b){c.push(d);break}else{c.push(d.substr(0,b));d=d.substr(b)}}return c}function start(){game=new Game;console.log("start")}function finish(){clearInterval(game.renderer);start()}function nextLevel(){if(game.stageIndex<game.stages.length-1){clearInterval(game.renderer);game.stageIndex++;game.load()}else{game.state="gamecomplete"}}var base=5;Game.prototype.loadStages=function(){this.stages.push({scouts:3,drones:0,destructors:0,mothers:0,dialogs:["A/W/S/D move         Enter to skip message","Enemies incomming!","Warning! Don't let   the ball behind you","One more thing       capt'n teerex rainbow","Good luck"]});this.stages.push({scouts:0,drones:3,destructors:0,mothers:0,dialogs:["Drones incomming...","GO!"]});this.stages.push({scouts:0,drones:0,destructors:2,mothers:0,dialogs:["Destructorships ahead","Fireeeeeee!"]});this.stages.push({scouts:3,drones:4,destructors:1,mothers:0,dialogs:["Great. Now you are   ready for the        invasion"]});this.stages.push({scouts:3,drones:2,destructors:2,mothers:0,dialogs:["Enemies incomming"]});this.stages.push({scouts:3,drones:2,destructors:0,mothers:0,dialogs:[]});this.stages.push({scouts:0,drones:0,destructors:0,mothers:1,dialogs:["Mothership ahead"]});this.stages.push({scouts:2,drones:2,destructors:1,mothers:0,dialogs:[]});this.stages.push({scouts:2,drones:2,destructors:2,mothers:0,dialogs:[]});this.stages.push({scouts:2,drones:8,destructors:0,mothers:0,dialogs:[]});this.stages.push({scouts:2,drones:4,destructors:0,mothers:1,dialogs:[]});this.stages.push({scouts:4,drones:2,destructors:1,mothers:1,dialogs:[]});this.stages.push({scouts:2,drones:6,destructors:1,mothers:1,dialogs:["Beware!"]});this.load();loadListeners();this.controller=new Controller};Game.prototype.load=function(){var a=this.stages[this.stageIndex];this.enemys=new Array;this.stars=new Array;this.particles=new Array;this.dialogs=new Array;this.perks=new Array;this.dialogIndex=0;this.locked=true;this.playerReady=false;this.gameOver=false;this.enemyiesReady=false;this.finish=false;this.gameComplete=false;this.stageComplete=false;this.finishTimeoutStep=0;this.stageCompleteTimeoutStep=0;this.spawnBallTimeoutStep=0;for(var b=0;b<a.dialogs.length;b++){this.dialogs.push(a.dialogs[b])}this.currentDialog=this.dialogs[this.dialogIndex];for(var b=0;b<a.drones;b++){this.enemys.push(new Drone(Math.random()*150+b*20,-30,Math.random()*100+50))}for(var b=0;b<a.scouts;b++){this.enemys.push(new Scout(Math.random()*150+b*20,-30,Math.random()*100+50))}for(var b=0;b<a.destructors;b++){this.enemys.push(new Destructor(Math.random()*150+b*20,-30,Math.random()*100+50))}for(var b=0;b<a.mothers;b++){this.enemys.push(new Mothership(Math.random()*150+b*20,-30,Math.random()*100+50))}for(var b=0;b<20;b++){this.stars.push({x:Math.random()*this.screen.x,y:Math.random()*this.screen.y,v:Math.random()*5})}this.ball=new Ball(this.screen.x/2,this.screen.y/2);this.ball.v.x=Math.random()*-5;this.ball.v.y=Math.random()*-5-5;this.player=new Player(this.screen.x/2,this.screen.y-50,this.screen.y+50);this.state="dialog";this.renderer=setInterval("game.render()",1e3/23)};Game.prototype.render=function(){var a=this;if(a.state=="complete"){a.finishTimeoutStep++;if(a.finishTimeoutStep>=a.finishTimeout)nextLevel()}if(!a.areEnemysAlive()){a.stageCompleteTimeoutStep++;if(a.stageCompleteTimeoutStep>a.stageCompleteTimeout)a.state="complete"}if(!(a.player.life>0))a.state="gameover";if(a.state=="dialog"){if(a.controller.keys["13"]){if(a.dialogIndex<a.dialogs.length-1){a.dialogIndex++;a.currentDialog=a.dialogs[a.dialogIndex];a.controller.keys["13"]=false}else a.state="intro"}}if(a.state=="running"){for(var b in a.enemys){var c=a.enemys[b];c.update();if(a.collides(c.x,c.y,c.w,c.h,a.ball.x-a.ball.bounds.x/2,a.ball.y-a.ball.bounds.y/2,a.ball.bounds.x,a.ball.bounds.y)){c.life=-1}if(c.life<0){a.enemys.splice(b,1);a.createExplosion(c.x,c.y);a.createParticles(c.x,c.y,getColor(255,200,100,1),10,10)}}a.ball.onUpdate();a.player.update()}if(a.state=="intro"){if(a.player.y>a.player.startY){a.player.y-=5}else{a.state="running"}}if(a.state=="intro"||a.state=="running"){for(var b in a.enemys){var c=a.enemys[b];if(c.y<c.startY){c.y+=1}}}for(var d in a.particles){var e=a.particles[d];e.x+=e.vx;e.y+=e.vy;e.life--;e.color.a-=.01;if(!a.isInScreen(e.x,e.y)||e.color.a<0){a.particles.splice(d,1)}if(e.life<0){a.particles.splice(d,1)}}for(var f in a.stars){var g=a.stars[f];if(!a.isInScreen(g.x+5,g.y+5)){g.x=Math.random()*a.screen.x;g.y=Math.random()*a.screen.y}g.y+=g.v}if(a.glow.value<a.glow.min||a.glow.value>a.glow.max){a.glow.fac*=-1}a.glow.value+=a.glow.fac;a.draw()};Game.prototype.draw=function(){var a=this;a.ctx.clearRect(0,0,a.screen.x,a.screen.y);game.ctx.font="bold 18pt Courier";for(var b in a.stars){var c=a.stars[b];game.ctx.translate(c.x,c.y);game.ctx.shadowBlur=10;game.ctx.fillStyle="rgba(255,255,255,1)";game.ctx.shadowColor="rgba(255,255,255,1)";game.ctx.fillRect(0,0,4,2);game.ctx.fillRect(1,-1,2,4);game.ctx.translate(-c.x,-c.y);game.ctx.restore()}for(var d in a.particles){var e=a.particles[d];game.ctx.save();game.ctx.translate(e.x+e.w/2,e.y+e.h/2);game.ctx.shadowBlur=10;if(!e.color){game.ctx.fillStyle="rgba(200,200,200,1)";game.ctx.shadowColor="#00f"}else{game.ctx.fillStyle="rgba("+e.color.r+","+e.color.g+","+e.color.b+","+e.color.a+")";game.ctx.shadowColor="rgba("+e.color.r+","+e.color.g+","+e.color.b+","+e.color.a+")"}game.ctx.fillRect(-e.w/2,-e.h/2,e.w,e.h);game.ctx.translate(-(e.x+e.w/2),-(e.y+e.h/2));game.ctx.restore()}if(a.state=="gameover"){game.ctx.fillStyle="#ff0000";game.ctx.fillText("Game Over",a.screen.x/2-80,a.screen.y/2);game.ctx.fillText("Your score "+a.score,a.screen.x/2-80,a.screen.y/2+40)}if(a.state=="running"||a.state=="intro"){for(var f in a.enemys){var g=a.enemys[f];g.draw()}a.ball.onDraw();a.player.draw();game.ctx.fillStyle="rgba(200,200,200,1)";game.ctx.shadowColor="#ccc";game.ctx.fillRect(10,10,game.ball.bounds.x,game.ball.bounds.y);game.ctx.font="bold 14pt Courier";game.ctx.fillStyle="#333";game.ctx.fillText("x "+game.score,15+game.ball.bounds.x,10+game.ball.bounds.y);game.ctx.font="bold 14pt Courier";game.ctx.fillStyle="#333";game.ctx.fillText(game.stageIndex+1+"/"+game.stages.length+" Stages",game.screen.x-130,30)}if(a.state=="gamecomplete"){game.ctx.fillStyle="#ffff00";game.ctx.fillText("Game complete",a.screen.x/2-120,a.screen.y/2);game.ctx.shadowBlur=a.glow.value;game.ctx.font="bold 14pt Courier";game.ctx.fillText("Pixels from outerspace",a.screen.x/2-120,a.screen.y/2+20);game.ctx.fillText("Your score "+a.score,a.screen.x/2-120,a.screen.y/2+40)}if(a.state=="complete"){a.createParticles(Math.random()*a.screen.x,Math.random()*a.screen.y,{r:Math.round(Math.random()*255),g:Math.round(Math.random()*255),b:Math.round(Math.random()*255),a:1},10,10);game.ctx.fillStyle="#ffff00";game.ctx.shadowBlur=a.glow.value;game.ctx.fillText("Stage complete",a.screen.x/2-120,a.screen.y/2)}if(a.state=="dialog"){game.ctx.fillStyle="rgba(200,200,200,0.7)";game.ctx.shadowColor="#ccc";game.ctx.shadowBlur=a.glow.value;game.ctx.fillRect(10,a.screen.y-100,a.screen.x-20,a.screen.y-(a.screen.y-90));game.ctx.font="bold 10pt Courier";game.ctx.fillStyle="#333";game.ctx.shadowBlur=0;var h=StringSplitter(a.currentDialog,21);for(var d in h){game.ctx.fillText(">> "+h[d],15,a.screen.y-85+d*12)}}game.ctx.shadowColor="#000";game.ctx.shadowBlur=5;game.ctx.drawImage(game.lines,0,0,game.lines.width,game.lines.height,0,0,game.screen.x,game.screen.y)};Game.prototype.areEnemysAlive=function(){return this.enemys.length>0};Game.prototype.isInScreen=function(a,b){if(a>0&&a<this.screen.x&&b>0&&b<this.screen.y){return true}return false};Game.prototype.collides=function(a,b,c,d,e,f,g,h){if(a+c>e&&a<e+g&&b+d>f&&b<f+h){return true}return false};Game.prototype.createParticles=function(a,b,c,d,e,f){var g=f|10;for(i=0;i<360/(360/e);i++){this.particles.push({x:a,y:b,vx:Math.cos(i)*(Math.random()*g*2-g),vy:Math.sin(i)*(Math.random()*g*2-g),w:5,h:5,color:c,life:d})}};Game.prototype.createExplosion=function(a,b){var c=10;for(i=0;i<360/12;i++){this.particles.push({x:a,y:b,vx:Math.cos(i)*c,vy:Math.sin(i)*c,w:5,h:5,color:{r:200,g:200,b:200,a:1},life:100})}};Mob.prototype.update=function(){};Mob.prototype.draw=function(){};Player.prototype.draw=function(){game.ctx.save();game.ctx.translate(this.x,this.y);game.ctx.shadowBlur=10;for(var a in this.tiles){var b=this.tiles[a];game.ctx.fillStyle="rgba("+b.color.r+","+b.color.g+","+b.color.b+","+b.color.a+")";game.ctx.shadowColor="rgba("+b.color.r+","+b.color.g+","+b.color.b+","+b.color.a+")";game.ctx.fillRect(b.x,b.y,b.w,b.h)}game.ctx.translate(-this.x,-this.y);game.ctx.restore();for(var c in this.guns){var d=this.guns[c];d.draw()}game.ctx.shadowColor="rgba(255,180,0,1)";game.ctx.shadowBlur=10;game.ctx.fillStyle="rgba(255,255,0,1)";game.ctx.fillRect(game.screen.x-70,game.screen.y-25,100/100*50,5);game.ctx.fillStyle="rgba(255,0,0,1)";game.ctx.fillRect(game.screen.x-70,game.screen.y-25,this.life/100*50,5);game.ctx.font="8pt Courier";game.ctx.fillText("life "+this.life+"%",game.screen.x-150,game.screen.y-20)};Player.prototype.update=function(){if(this.life<=0&&!this.alive){game.createExplosion(this.x+this.w/2,this.y);this.alive=false}if(game.controller.keys["87"]){this.v.y=-5}else{this.v.y=0}if(game.controller.keys["83"]){this.v.y=5}if(game.controller.keys["65"]){this.v.x=-5}else if(game.controller.keys["68"]){this.v.x=5}else{this.v.x=0}game.player.shoot();if(game.controller.keys["32"]){for(var a in this.guns){var b=this.guns[a];if(b.name=="Rocketlauncher")b.shoot()}}for(var a in this.guns){var b=this.guns[a];this.guns[a].update()}if(game.isInScreen(this.x+this.w+this.v.x,this.y+this.h)&&game.isInScreen(this.x+this.v.x,this.y+this.h)&&game.isInScreen(this.x,this.y+this.h+this.v.y)&&game.isInScreen(this.x,this.y+this.v.y)){this.x+=this.v.x;this.y+=this.v.y}else{if(game.stageComplete){game.finish=true}}};Player.prototype.shoot=function(){for(var a in this.guns){var b=this.guns[a];b.shoot(this.x+b.x+(Math.random()*this.spread-this.spread/2),this.y+b.y-this.h)}};Controller.prototype.keyDown=function(a){this.keys[a]=true};Controller.prototype.keyUp=function(a){this.keys[a]=false};Controller.prototype.getKeyCode=function(a){a=a||window.event;return a.keyCode};Enemy.prototype.update=function(){for(var a in this.guns){var b=this.guns[a];b.update()}if(!game.isInScreen(this.x+this.w,this.y)||!game.isInScreen(this.x+this.w,this.y)){this.vx=this.vx*-1}this.shoot();this.x+=this.vx;this.y+=this.vy};Enemy.prototype.draw=function(){game.ctx.save();game.ctx.translate(this.x,this.y);game.ctx.shadowBlur=10;for(var a in this.tiles){var b=this.tiles[a];game.ctx.fillStyle="rgba("+b.color.r+","+b.color.g+","+b.color.b+","+b.color.a+")";game.ctx.shadowColor="rgba("+b.color.r+","+b.color.g+","+b.color.b+","+b.color.a+")";game.ctx.fillRect(b.x,b.y,b.w,b.h)}game.ctx.translate(-this.x,-this.y);game.ctx.restore();for(var c in this.guns){var d=this.guns[c];d.draw()}};Enemy.prototype.shoot=function(){for(var a in this.guns){var b=this.guns[a];b.shoot(this.x+b.x+(Math.random()*this.spread-this.spread/2),this.y+b.y-b.h/2+this.h)}};Scout.prototype=new Enemy;Scout.prototype.constructor=Enemy;Destructor.prototype=new Enemy;Destructor.prototype.constructor=Enemy;Drone.prototype=new Enemy;Drone.prototype.constructor=Enemy;Mothership.prototype=new Enemy;Mothership.prototype.constructor=Enemy;GunBase.prototype.draw=function(){for(var a in this.bullets){var b=this.bullets[a];game.ctx.save();game.ctx.translate(b.x,b.y);game.ctx.shadowBlur=20;game.ctx.fillStyle="rgba("+this.color.r+","+this.color.g+","+this.color.b+","+this.color.a+")";game.ctx.shadowColor="rgba("+this.color.r+","+this.color.g+","+this.color.b+","+this.color.a+")";game.ctx.fillRect(0,0,this.w,this.h);game.ctx.translate(-b.x,-b.y);game.ctx.restore()}};GunBase.prototype.update=function(){if(this.reloadStep>=this.reloadSpeed&&!this.canShoot){this.canShoot=true;this.reloadStep=0}else{if(!this.canShoot)this.reloadStep++}for(var a in this.bullets){var b=this.bullets[a];if(b.active){var c=true;b.x+=Math.cos(b.r)*b.v;b.y+=Math.sin(b.r)*b.v;for(var d in game.enemys){var e=game.enemys[d];if(game.collides(b.x,b.y,this.w,this.h,e.x,e.y,e.w,e.h)){c=false;game.createParticles(b.x,b.y,getColor(255,50,0,1),20,10);game.createParticles(b.x,b.y,getColor(255,250,0,1),5,5);e.life-=this.damage;b.active=false}if(game.collides(b.x,b.y,this.w,this.h,game.player.x,game.player.y,game.player.w,game.player.h)){game.createParticles(b.x,b.y,getColor(255,50,0,1),20,10);game.createParticles(b.x,b.y,getColor(255,250,0,1),5,5);c=false;game.player.life-=this.damage;b.active=false}}if(!game.isInScreen(b.x,b.y)){b.active=false}}else{this.bullets.splice(a,1)}}};GunBase.prototype.shoot=function(a,b){if(this.canShoot){this.bullets.push({x:a,y:b,v:10,r:this.r,vx:0,vy:-5,active:true});this.canShoot=false}};LaserGun.prototype=new GunBase;BomberGun.prototype=new GunBase;GetlingGun.prototype=new GunBase;PlayerGun.prototype=new GunBase;Ball.prototype.onUpdate=function(){this.x+=this.v.x;this.y+=this.v.y;if(this.y+this.v.y<=0){this.v.y*=-1;this.v.dir=1;game.score++}if(this.x-this.bounds.x/2<=0||this.x+this.bounds.x/2>=game.screen.x){this.v.x*=-1}if(this.glow.value<this.glow.min||this.glow.value>this.glow.max){this.glow.fac*=-1}this.glow.value+=this.glow.fac;if(!game.isInScreen(this.x,this.y+this.v.y,this.bounds.x,this.bounds.y)){game.score=0;this.create()}if(game.collides(this.x-this.bounds.x/2,this.y+this.v.y-this.bounds.y/2,this.bounds.x,this.bounds.y,game.player.x,game.player.y,game.player.w,game.player.h)){this.v.y*=-1;this.v.dir=-1}};Ball.prototype.onDraw=function(){game.ctx.translate(this.x-this.bounds.x/2,this.y-this.bounds.y/2);game.ctx.fillStyle="rgba(200,200,200,1)";game.ctx.shadowColor="rgba(200,200,200,1)";game.ctx.shadowBlur=this.glow.value;game.ctx.fillRect(0,0,this.bounds.x,this.bounds.y);game.ctx.translate(-(this.x-this.bounds.x/2),-(this.y-this.bounds.y/2))};Ball.prototype.create=function(){this.x=this.spawn.x;this.y=this.spawn.y};var game